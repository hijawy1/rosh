function replace_audio_video_tags(){$("#question_description .mejs-container audio, #question_description .mejs-container video, #question_explanation .mejs-container audio, #question_explanation .mejs-container video").each(function(){var e=$(this),t=$(this).attr("src")||$(this).children("source").attr("src"),i=(t=t.split("/")).pop(),s=(i=i.split(".")).pop();i=i.join(".").split("_encoded")[0]+"."+s;var a='<p><a class="attach_'+s+'" href="'+(t=t.join("/")+"/"+i)+'" title="'+i+'" data-content-type="'+$(this).attr("type")+'">'+i+"</a></p>";e.closest(".mejs-container").replaceWith(a)})}var Question=Question||{},ExamQuestion={setQuestionValues:function(e){Question.setValues(e)}};$.extend(!0,Question,{setValues:function(e){e&&$("#current_question_count").html(Exam.question_ids.indexOf(e)+1),this.displayCategoriesName(),this.displayTags(),this.qid&&$(".question_slug").html(this.qid),Question.viewable?(Question.detailsBox.show(),Question.unavailableBox.hide(),$("#question_description").html(this.description),$("#answer_options").html(this.answer_options),this.flagged?$("#flag_question").addClass("active"):$("#flag_question").removeClass("active"),this.explanation?$("#question_explanation").html(this.explanation).prev("p,h2,h3").addBack().show():$("#question_explanation").prev("p,h2,h3").addBack().hide(),this.references?$("#references_list").html(this.references).prev("p,h2,h3").addBack().show():$("#references_list").prev("p,h3,h2").addBack().hide(),this.displayOneStepQuestionAndAnswer(),this.correct_answer&&$("#correct_answer").html(this.correct_answer),this.peer_compare&&$("#peer_comparison, #peer_comparison_graph").html(this.peer_compare),this.id&&$("#question_id").val(this.id),this.displayAnswerStatus(),this.displayRapidReview(),this.displayBeyondTheBoards(),CkeditorOveride.adjustListStyles()):(Question.detailsBox.hide(),Question.unavailableBox.show())},displayCategoriesName:function(){is_mobile()||(this.category&&$("#category_name").html(this.category),this.subcategory&&$("#subcategory_name").html(this.subcategory))},displayTags:function(){is_mobile()||$("#question_answer_tags").html(this.tags)},displayOneStepQuestionAndAnswer:function(){this.osf_question||this.osf_answer?($("#one_step_block").removeClass("hidden"),$("#osf_question").html(this.osf_question||""),$("#osf_answer").html(this.osf_answer||"")):$("#one_step_block").addClass("hidden")},displayRapidReview:function(){this.rapid_review&&($("#rapid-review-data").html(this.rapid_review),$("#rapid_review_block").show())},displayBeyondTheBoards:function(){this.beyond_the_boards&&($("#beyond-boards-data").html(this.beyond_the_boards),$("#beyond_the_boards_block").show())},displayAnswerStatus:function(){1==this.marked_correct?$("#result_message").html("Your Answer is Correct").addClass("notice-message").removeClass("error-message hidden"):0==this.marked_correct?$("#result_message").html("Your Answer is Incorrect").addClass("error-message").removeClass("notice-message hidden"):$("#result_message").html("").removeClass("error-message notice-message")}});var loaderOptions={beforeSend:function(){Loader.show($bodyContainer)},complete:function(){Loader.hide($bodyContainer)}},Exam={question_ids:[],gather_data:function(e,t){var i=$("input[name=is_review]").val();return marked_answer_id=$("input:radio[name=marked_answer]:checked").val(),data="exam_question_id="+e+"&is_review="+i,t&&(data+="&next_exam_question_id="+t),"undefined"!=typeof marked_answer_id&&(data+="&marked_answer_id="+marked_answer_id),$("a.highLight").hasClass("hightLight")&&(data+="&flagged=true"),Question.highlighted?(data+="&highlighted=true",Question.highlighted("question_description")&&(replace_audio_video_tags(),text=$("#question_description").html(),data+="&question_text="+encodeURIComponent(text)),Question.highlighted("question_explanation")&&(replace_audio_video_tags(),text=$("#question_explanation").html(),data+="&explanation_text="+encodeURIComponent(text)),Question.highlighted("answer_options")&&$("#answer_options").children("li").each(function(){if(Question.highlighted($(this))){var e=$(this).children("input").val()||$(this).attr("id"),t=$(this).find("span.rr_start"),i=t.html();t.hasClass("rr_highlight")&&(i="<span class='rr_highlight'>"+i+"</span>"),t.hasClass("rr_strikeout")&&(i="<span class='rr_strikeout'>"+i+"</span>"),data+="&answer_options["+e+"]="+encodeURIComponent(i)}})):data+="&highlighted=false",data},prev_question:function(){current_id=parseInt($("#current_question_count").html()),prev_id=current_id-1||0,prev_id>0&&(prev_box_id=$("div.QueBlock a:nth-child("+prev_id+")").attr("id"),prev_question_id=parseInt(prev_box_id.split("_").pop()),Exam.fetch_question(prev_question_id)),1==prev_id&&$(".prev#prev_question").addClass("disabled-link")},next_question:function(){current_id=parseInt($("#current_question_count").html()),next_id=current_id+1||Number.POSITIVE_INFINITY,total_questions=parseInt($("#total_question_count").html()),next_id<=total_questions&&(next_box_id=$("div.QueBlock a:nth-child("+next_id+")").attr("id"),next_question_id=parseInt(next_box_id.split("_").pop()),Exam.fetch_question(next_question_id),next_id==total_questions&&($(".next#next_question").addClass("disabled-link"),$(this).addClass("disable-link")))},fetch_question:function(e){$(".prev, .next").removeClass("disable-link"),$(".prev, .next").removeClass("disabled-link"),$("#rapid_review_block").hide(),$("#beyond_the_boards_block").hide();var t=parseInt($("a.highLight").attr("id").split("_").pop()),i=Exam.gather_data(t,e),s=$("a.highLight");stop_all_media(),Exam.allowed(e)?$.ajax($.extend({url:"/exams/fetch_question.js",data:i,type:"POST",success:function(){$("input:radio[name=marked_answer]:checked").length>0?s.removeClass("active"):""==$("#answer_detail").html()&&s.addClass("active"),ExamQuestion.setQuestionValues(e),Question.qid||Question.has_viewed_answer?($("div#answer_detail, .question_buttons, #peer_comparison_graph, #feedback_link, div.examDesc, #question_answer_tags").removeClass("hidden"),$(".answer_buttons, #clear_answer").addClass("hidden")):($("div#answer_detail, .question_buttons, #peer_comparison_graph, #feedback_link, div.examDesc, #question_answer_tags").addClass("hidden"),$(".answer_buttons, #clear_answer").removeClass("hidden")),new_question=$("#exam_question_"+e),$("#current_question_count").html(new_question.attr("index")),s.removeClass("highLight"),new_question.addClass("highLight"),$("#osf_answer").addClass("hidden"),$("span#one_step_answer").addClass("link_button").html("Reveal Answer: "),$(".QueBlock > a:nth-child("+Question.current_question+")").removeClass("hidden"),$("#result_message").html(null).removeClass("error-message notice-message"),Exam.disable_radios(),Custom.init(),Colorbox.colorbox(),load_player_for_media(),window.scrollTo(0,0),1==$("#current_question_count").html()&&$(".prev#prev_question").addClass("disabled-link"),$("#current_question_count").html()==$("#total_question_count").html()&&$(".next#next_question").addClass("disabled-link")},error:function(){window.location=Routes.subscribers.dashboard_path}},loaderOptions)):alert("Not allowed to view that question right now"),question_no=parseInt($("#exam_question_"+e).html()),Exam.hide_previous_or_next_links(question_no)},add_hidden_fields:function(e){var t=parseInt($("a.highLight").attr("id").split("_").pop()),i=Exam.gather_data(t,null).split("&");$.each(i,function(t,i){var s=i.split("=");e.append($("<input/>",{type:"hidden",name:s.shift(),value:s.join("=")}))})},hide_previous_or_next_links:function(e){1==e&&$(".prev").addClass("disable-link"),e==parseInt($("#total_question_count").html())&&$(".next").addClass("disable-link")},show_answer:function(e,t){var i=Exam.gather_data(e,null);stop_all_media(),$.ajax($.extend({url:"/exams/show_answer.js",type:"POST",data:i,success:function(){$("input:radio[name=marked_answer]:checked").length>0&&$("a.highLight").removeClass("active"),t?(ExamQuestion.setQuestionValues(e),$(".highLight").removeClass("highLight").prev().addClass("highLight")):ExamQuestion.setQuestionValues(),$("div#answer_detail, .question_buttons, #peer_comparison_graph, #feedback_link, div.examDesc, #question_answer_tags").removeClass("hidden"),$(".answer_buttons, #clear_answer, #osf_answer").addClass("hidden"),$(".QueBlock > a:nth-child("+Question.current_question+")").removeClass("hidden").addClass("available"),Exam.disable_radios(),Colorbox.colorbox(),load_player_for_media(),window.scrollTo(0,0)}},loaderOptions))},disable_previous_next_link:function(){var e=$(".prev"),t=$(".next");return previous_link_id=e[0].id,e.removeAttr("id").addClass("disable_link"),next_link_id=t[0].id,t.removeAttr("id").addClass("disable_link"),previous_link_id},enable_previous_next_link:function(e,t){var i=$(".prev"),s=$(".next");i.attr("id",e).removeClass("disable_link"),s.attr("id",t).removeClass("disable_link")},disable_radios:function(){Question.has_viewed_answer?$("input:radio[name=marked_answer]").attr("disabled","disabled"):$("input:radio[name=marked_answer]").attr("disabled",null)},clear_answer:function(){$("input").attr("checked",null),$(".highLight").addClass("active"),$(".radio").css("backgroundPosition-y","0px")},allowed:function(e){return 0==$("#next_answer").length||!(parseInt($("#exam_question_"+e).html())>Question.current_question)}};$(window).load(function(){Question.current_question=parseInt($("#exam_question_"+$("#max_viewed_question").val()).html()||0)+1,$(".QueBlock > a:lt("+Question.current_question+")").addClass("available").removeClass("hidden"),$("#max_viewed_question").val()||$(".QueBlock > a").addClass("available"),Exam.hide_previous_or_next_links(Question.current_question)}),$(function(){$bodyContainer=$("#container"),Question.has_viewed_answer=eval($("#has_viewed_answer").val()),Exam.disable_radios(),$(document).delegate("#next_question","click",Exam.next_question),$(document).delegate("div.QueBlock > a","click",function(){var e=parseInt($(this).attr("id").split("_").pop());Exam.fetch_question(e)}),$(document).delegate("#prev_question","click",Exam.prev_question),$(document).delegate("#show_answer","click",function(){current_id=parseInt($("a.highLight").attr("id").split("_").pop()),Exam.show_answer(current_id,!1)}),$("#save_exam").closest("form").submit(function(){if(0==$(this).children("div").length){$(this).wrapInner("<div></div>");var e=$(this).children("div")}return Exam.add_hidden_fields(e),!0}),$("#submit_exam").closest("form").submit(function(){if(0==$(this).children("div").length){$(this).wrapInner("<div></div>");var e=$(this).children("div")}return Exam.add_hidden_fields(e),!0}),$("#clear_answer").click(function(){Exam.clear_answer()}),$("span#one_step_answer").bind("click",function(){$("#osf_answer").removeClass("hidden"),$(this).removeClass("link_button").html("Answer: ")})});